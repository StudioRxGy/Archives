# py12306 购票助手 - 项目说明

## 项目概述

这是一个基于 Python 的 12306 火车票自动购票助手，支持多账号、多任务、分布式运行。

## 主要功能

- ✅ 多日期查询余票
- ✅ 自动打码下单
- ✅ 用户状态恢复
- ✅ 多账号、多任务、多线程支持
- ✅ 单个任务多站点查询
- ✅ 分布式运行（需要 Redis）
- ✅ Docker 支持
- ✅ Web 管理页面
- ✅ 多种通知方式（语音、邮件、钉钉、Telegram、微信等）

## 环境配置

### 已完成的配置

1. ✅ 创建 conda 虚拟环境：`py12306`（Python 3.9）
2. ✅ 安装所有依赖包
3. ✅ 创建配置文件：`env.py`
4. ✅ 创建运行时目录：`runtime/`

### 当前配置状态

- **Web 管理**: 已启用
- **Web 端口**: 8008
- **打码平台**: free（免费打码）
- **查询间隔**: 1秒
- **用户账号**: 需要配置
- **查询任务**: 需要配置

## 使用方法

### 方法一：使用启动脚本（推荐）

直接双击运行 `start.bat`，然后选择运行模式：
- 选项 1：测试模式（检查配置）
- 选项 2：正式运行
- 选项 3：Web 管理模式

### 方法二：命令行运行

```bash
# 激活 conda 环境
conda activate py12306

# 测试配置
python main.py -t

# 测试配置和通知
python main.py -t -n

# 正式运行
python main.py

# 使用自定义配置文件
python main.py -c your_config.py
```

### 方法三：不激活环境直接运行

```bash
# 测试模式
conda run -n py12306 python main.py -t

# 正式运行
conda run -n py12306 python main.py
```

## 配置说明

### 1. 配置账号信息

编辑 `env.py` 文件，修改以下部分：

```python
USER_ACCOUNTS = [
    {
        'key': 0,
        'user_name': '你的12306用户名',
        'password': '忽略',
        'type': 'qr'  # qr 为扫码登录，其他为密码登录
    },
]
```

### 2. 配置查询任务

```python
QUERY_JOBS = [
    {
        'account_key': 0,  # 使用的账号
        'left_dates': [    # 出发日期
            "2026-02-01",
            "2026-02-02",
        ],
        'stations': {      # 车站
            'left': '北京',
            'arrive': '深圳',
        },
        'members': [       # 乘客姓名
            "张三",
        ],
        'seats': [         # 座位类型
            '硬卧',
            '硬座'
        ],
        'train_numbers': [],  # 指定车次（空则所有车次）
    },
]
```

### 3. 配置通知方式（可选）

在 `env.py` 中可以配置：
- 语音验证码通知
- 邮件通知
- 钉钉通知
- Telegram 通知
- 微信推送（ServerChan、PushBear）
- Bark 推送

## Web 管理界面

启动程序后，访问：http://127.0.0.1:8008

默认登录信息：
- 用户名：`admin`
- 密码：`password`

可以在 `env.py` 中修改：
```python
WEB_USER = {
    'username': 'admin',
    'password': 'password'
}
```

## 座位类型说明

可用的座位类型：
- 特等座
- 商务座
- 一等座
- 二等座
- 软卧
- 硬卧
- 动卧
- 软座
- 硬座
- 无座

## 注意事项

1. **账号安全**：建议使用扫码登录（`type: 'qr'`）
2. **查询频率**：不要设置过高的查询频率，避免被限制
3. **打码平台**：免费打码可能不稳定，建议配置若快打码账号
4. **日期设置**：确保查询日期是未来的日期
5. **车站名称**：使用中文全称，如"北京"、"深圳"

## 分布式集群（高级功能）

如需使用分布式功能，需要：
1. 安装并启动 Redis
2. 在 `env.py` 中配置：
```python
CLUSTER_ENABLED = 1
NODE_IS_MASTER = 1
REDIS_HOST = 'localhost'
REDIS_PORT = '6379'
```

## 故障排除

### 问题：无法启动
- 检查 conda 环境是否激活
- 检查依赖是否完整安装：`conda run -n py12306 pip list`

### 问题：配置错误
- 运行测试模式检查：`conda run -n py12306 python main.py -t`
- 查看日志文件：`runtime/12306.log`

### 问题：无法登录
- 确认账号密码正确
- 建议使用扫码登录方式
- 检查网络连接

## 项目结构

```
py12306/
├── data/              # 数据文件（车站信息、CDN列表）
├── py12306/           # 核心代码
│   ├── app.py        # 应用主类
│   ├── config.py     # 配置管理
│   ├── cluster/      # 集群功能
│   ├── helpers/      # 辅助工具
│   ├── log/          # 日志模块
│   ├── order/        # 订单模块
│   ├── query/        # 查询模块
│   ├── user/         # 用户模块
│   └── web/          # Web 管理界面
├── runtime/          # 运行时数据
├── env.py            # 配置文件
├── main.py           # 程序入口
├── start.bat         # 启动脚本
└── requirements.txt  # 依赖列表
```

## 更多信息

- GitHub: https://github.com/pjialin/py12306
- QQ 交流群: 780289875
- Telegram 群: https://t.me/joinchat/F3sSegrF3x8KAmsd1mTu7w

## 许可证

Apache License 2.0
