# é…ç½®ç®¡ç†ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®å·²é›†æˆç»Ÿä¸€çš„é…ç½®ç®¡ç†ç³»ç»Ÿ `AppSettings`ï¼Œæ”¯æŒå¤šç¯å¢ƒé…ç½®å’Œè·¯å¾„ç®¡ç†ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å•ä¾‹æ¨¡å¼
é…ç½®ç±»ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼š
```csharp
var settings = AppSettings.Instance;
```

### 2. å¤šç¯å¢ƒæ”¯æŒ
æ”¯æŒ 4 ç§è¿è¡Œç¯å¢ƒï¼š
- **Development** - å¼€å‘ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰
- **Test** - æµ‹è¯•ç¯å¢ƒ
- **Staging** - é¢„å‘å¸ƒç¯å¢ƒ
- **Production** - ç”Ÿäº§ç¯å¢ƒ

### 3. è‡ªåŠ¨è·¯å¾„ç®¡ç†
è‡ªåŠ¨æŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•å¹¶åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„ï¼š
```
CsPlaywrightApi/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ output/
â”‚       â”œâ”€â”€ logs/              # æ—¥å¿—ç›®å½•
â”‚       â”‚   â””â”€â”€ 20260114_173012/
â”‚       â”‚       â”œâ”€â”€ api_log.json
â”‚       â”‚       â””â”€â”€ api_report.html
â”‚       â””â”€â”€ screenshots/       # æˆªå›¾ç›®å½•
â”œâ”€â”€ reports/                   # æŠ¥å‘Šç›®å½•
â”œâ”€â”€ config/                    # é…ç½®ç›®å½•
â””â”€â”€ case/                      # æµ‹è¯•ç”¨ä¾‹ç›®å½•
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åœ¨æµ‹è¯•ç±»ä¸­ä½¿ç”¨é…ç½®

**ä¿®æ”¹å‰ï¼ˆç¡¬ç¼–ç è·¯å¾„ï¼‰ï¼š**
```csharp
public async Task InitializeAsync()
{
    var projectRoot = Directory.GetParent(AppContext.BaseDirectory)?.Parent?.Parent?.Parent?.FullName 
                      ?? AppContext.BaseDirectory;
    var logPath = Path.Combine(projectRoot, "src", "output", "logs");
    
    _logger = new ApiLogger(logPath, enableConsoleLog: false);
    
    _playwright = await Playwright.CreateAsync();
    _apiContext = await _playwright.APIRequest.NewContextAsync(new()
    {
        BaseURL = "https://www.ast1001.com"
    });
}
```

**ä¿®æ”¹åï¼ˆä½¿ç”¨é…ç½®ï¼‰ï¼š**
```csharp
public UheyueApiTests(ITestOutputHelper output)
{
    _output = output;
    _settings = AppSettings.Instance;  // è·å–é…ç½®å®ä¾‹
}

public async Task InitializeAsync()
{
    // æ‰“å°é…ç½®ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    _settings.PrintConfigInfo();
    
    // ä½¿ç”¨é…ç½®åˆ›å»ºæ—¥å¿—è®°å½•å™¨ï¼ˆè‡ªåŠ¨ä½¿ç”¨é…ç½®çš„æ—¥å¿—ç›®å½•ï¼‰
    _logger = new ApiLogger(enableConsoleLog: _settings.EnableConsoleLog);
    
    _playwright = await Playwright.CreateAsync();
    _apiContext = await _playwright.APIRequest.NewContextAsync(new()
    {
        BaseURL = _settings.Config.BaseUrl,           // ä»é…ç½®è¯»å–
        Timeout = _settings.Config.Timeout * 1000     // ä»é…ç½®è¯»å–
    });

    _output.WriteLine($"ç¯å¢ƒ: {_settings.CurrentEnvironment}");
    _output.WriteLine($"Base URL: {_settings.Config.BaseUrl}");
}
```

### 2. è®¿é—®é…ç½®å±æ€§

```csharp
var settings = AppSettings.Instance;

// ç¯å¢ƒé…ç½®
Console.WriteLine($"å½“å‰ç¯å¢ƒ: {settings.CurrentEnvironment}");
Console.WriteLine($"Base URL: {settings.Config.BaseUrl}");
Console.WriteLine($"è¶…æ—¶æ—¶é—´: {settings.Config.Timeout}ç§’");
Console.WriteLine($"æ— å¤´æ¨¡å¼: {settings.Config.Headless}");
Console.WriteLine($"æ—¥å¿—çº§åˆ«: {settings.Config.LogLevel}");

// è·¯å¾„é…ç½®
Console.WriteLine($"é¡¹ç›®æ ¹ç›®å½•: {settings.BaseDirectory}");
Console.WriteLine($"æ—¥å¿—ç›®å½•: {settings.LogDirectory}");
Console.WriteLine($"è¾“å‡ºç›®å½•: {settings.OutputDirectory}");
Console.WriteLine($"æˆªå›¾ç›®å½•: {settings.ScreenshotDirectory}");

// Playwright é…ç½®
Console.WriteLine($"æµè§ˆå™¨ç±»å‹: {settings.BrowserType}");
Console.WriteLine($"è§†å£å¤§å°: {settings.ViewportWidth}x{settings.ViewportHeight}");

// å…¶ä»–é…ç½®
Console.WriteLine($"æœ€å¤§é‡è¯•æ¬¡æ•°: {settings.MaxRetries}");
Console.WriteLine($"å¤±è´¥æ—¶æˆªå›¾: {settings.ScreenshotOnFailure}");
```

### 3. è·å–æ–‡ä»¶è·¯å¾„

```csharp
var settings = AppSettings.Instance;

// è·å–æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨åˆ›å»ºä¼šè¯ç›®å½•ï¼‰
var logPath = settings.GetLogFilePath();
// è¾“å‡º: D:\...\src\output\logs\20260114_173012\api_log.json

// è·å– HTML æŠ¥å‘Šè·¯å¾„
var reportPath = settings.GetHtmlReportPath();
// è¾“å‡º: D:\...\src\output\logs\20260114_173012\api_report.html

// è·å–æˆªå›¾è·¯å¾„
var screenshotPath = settings.GetScreenshotPath("test_login");
// è¾“å‡º: D:\...\src\output\screenshots\test_login_20260114_173012.png
```

## ğŸ”§ ç¯å¢ƒåˆ‡æ¢

### æ–¹æ³•1ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

**Windows CMD:**
```cmd
set ENV=Test
dotnet test
```

**Windows PowerShell:**
```powershell
$env:ENV="Test"
dotnet test
```

**Linux/Mac:**
```bash
export ENV=Test
dotnet test
```

### æ–¹æ³•2ï¼šåœ¨ä»£ç ä¸­åˆ‡æ¢ï¼ˆä¸æ¨èï¼‰
ç¯å¢ƒåœ¨ `AppSettings` æ„é€ å‡½æ•°ä¸­ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œå»ºè®®é€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ã€‚

## ğŸ“Š ç¯å¢ƒé…ç½®è¯¦æƒ…

### Developmentï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```csharp
BaseUrl = "https://www.ast1001.com"
Timeout = 30ç§’
Headless = false
SlowMo = 100ms
LogLevel = "DEBUG"
```

### Testï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
```csharp
BaseUrl = "http://test.example.com"
Timeout = 30ç§’
Headless = false
SlowMo = 50ms
LogLevel = "INFO"
```

### Stagingï¼ˆé¢„å‘å¸ƒç¯å¢ƒï¼‰
```csharp
BaseUrl = "http://staging.example.com"
Timeout = 20ç§’
Headless = true
SlowMo = 0ms
LogLevel = "INFO"
```

### Productionï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```csharp
BaseUrl = "http://prod.example.com"
Timeout = 15ç§’
Headless = true
SlowMo = 0ms
LogLevel = "WARNING"
```

## ğŸ¨ æ‰“å°é…ç½®ä¿¡æ¯

åœ¨æµ‹è¯•åˆå§‹åŒ–æ—¶æ‰“å°é…ç½®ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š

```csharp
var settings = AppSettings.Instance;
settings.PrintConfigInfo();
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
              â °â¢·â¢¿â „
              â €â €â €â €â €â£¼â£·â£„
              â €â €â£¤â£¿â£‡â£¿â£¿â£§â£¿â¡„
              â¢´â ¾â ‹â €â €â »â£¿â£·â£¿â£¿â¡€
              ğŸ€â¢€â£¿â£¿â¡¿â¢¿â ˆâ£¿
              â €â €â €â¢ â£¿â¡¿â â €â¡Šâ €â ™
              â €â €â €â¢¿â£¿â €â €â ¹â£¿
              â €â €â €â €â ¹â£·â¡€â €â£¿â¡„
              â €â €â €â €â£€â£¼â£¿â €â¢ˆâ£§.

================================================================================
å½“å‰ç¯å¢ƒ: Development
é¡¹ç›®æ ¹ç›®å½•: D:\Test tools\Docs\Test Case\jinx\csharp\CsPlaywrightApi\CsPlaywrightApi
æ—¥å¿—ç›®å½•: D:\Test tools\Docs\Test Case\jinx\csharp\CsPlaywrightApi\CsPlaywrightApi\src\output\logs
è¾“å‡ºç›®å½•: D:\Test tools\Docs\Test Case\jinx\csharp\CsPlaywrightApi\CsPlaywrightApi\src\output
æˆªå›¾ç›®å½•: D:\Test tools\Docs\Test Case\jinx\csharp\CsPlaywrightApi\CsPlaywrightApi\src\output\screenshots
Base URL: https://www.ast1001.com
æµè§ˆå™¨ç±»å‹: chromium
æ— å¤´æ¨¡å¼: False
è¶…æ—¶æ—¶é—´: 30ç§’
æ—¥å¿—çº§åˆ«: DEBUG
================================================================================
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åœ¨æµ‹è¯•ç±»æ„é€ å‡½æ•°ä¸­è·å–é…ç½®
```csharp
private readonly AppSettings _settings;

public UheyueApiTests(ITestOutputHelper output)
{
    _output = output;
    _settings = AppSettings.Instance;
}
```

### 2. ä½¿ç”¨é…ç½®åˆ›å»º ApiLogger
```csharp
// è‡ªåŠ¨ä½¿ç”¨é…ç½®çš„æ—¥å¿—ç›®å½•å’Œæ§åˆ¶å°æ—¥å¿—è®¾ç½®
_logger = new ApiLogger(enableConsoleLog: _settings.EnableConsoleLog);
```

### 3. ä½¿ç”¨é…ç½®åˆ›å»º API ä¸Šä¸‹æ–‡
```csharp
_apiContext = await _playwright.APIRequest.NewContextAsync(new()
{
    BaseURL = _settings.Config.BaseUrl,
    Timeout = _settings.Config.Timeout * 1000
});
```

### 4. ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
```bash
# å¼€å‘ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰
dotnet test

# æµ‹è¯•ç¯å¢ƒ
set ENV=Test && dotnet test

# ç”Ÿäº§ç¯å¢ƒ
set ENV=Production && dotnet test
```

## ğŸ” é…ç½®æ–‡ä»¶ä½ç½®

é…ç½®ç±»ä½äºï¼š
```
CsPlaywrightApi/src/playwright/Core/Config/AppSettings.cs
```

ç¤ºä¾‹ä»£ç ä½äºï¼š
```
CsPlaywrightApi/src/playwright/Core/Config/ConfigExample.cs
```

## ğŸ“ ä¿®æ”¹é…ç½®

å¦‚éœ€ä¿®æ”¹ç¯å¢ƒé…ç½®ï¼Œç¼–è¾‘ `AppSettings.cs` ä¸­çš„ `LoadEnvironmentConfig()` æ–¹æ³•ï¼š

```csharp
private void LoadEnvironmentConfig()
{
    Config = CurrentEnvironment switch
    {
        Environment.Development => new EnvironmentConfig
        {
            BaseUrl = "https://your-dev-url.com",  // ä¿®æ”¹è¿™é‡Œ
            Timeout = 30,
            Headless = false,
            SlowMo = 100,
            LogLevel = "DEBUG"
        },
        // ... å…¶ä»–ç¯å¢ƒ
    };
}
```

## âœ… å·²æ›´æ–°çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶å·²æ›´æ–°ä¸ºä½¿ç”¨ `AppSettings` é…ç½®ï¼š

1. âœ… `UheyueApiTests.cs` - æ ‡å‡†æµ‹è¯•ç±»
2. âœ… `UheyueApiTestsWithFixture.cs` - Fixture æµ‹è¯•ç±»
3. âœ… `ApiLogger.cs` - æ—¥å¿—è®°å½•å™¨

## ğŸ¯ ä¸‹ä¸€æ­¥

1. è¿è¡Œæµ‹è¯•éªŒè¯é…ç½®æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š
   ```bash
   dotnet test
   ```

2. å°è¯•åˆ‡æ¢ç¯å¢ƒï¼š
   ```bash
   set ENV=Test
   dotnet test
   ```

3. æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œç¡®è®¤è·¯å¾„æ­£ç¡®ï¼š
   ```
   æ—¥å¿—ç›®å½•: D:\...\src\output\logs\20260114_173012\
   ```

é…ç½®ç®¡ç†ç³»ç»Ÿå·²å®Œå…¨é›†æˆï¼Œäº«å—æ›´çµæ´»çš„æµ‹è¯•ç¯å¢ƒç®¡ç†ï¼ğŸš€
